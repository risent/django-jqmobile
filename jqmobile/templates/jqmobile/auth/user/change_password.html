{% extends "jqmobile/base.html" %}
{% load i18n admin_modify adminmedia jqmobile_tags %} {# grp_csrf #}

{% block navbar %}{% get_breadcrumb request.path %}{% endblock %}

{% block userlinks %}
{% url django-admindocs-docroot as docsroot %}
    {% if docsroot %}
        <li>
            <a href="{{ docsroot }}">{% trans 'Documentation' %}</a>
        </li>
    {% endif %}
    <li>
        <a href="{{ root_path }}password_change/">{% trans 'Change password' %}</a>
    </li>
    <li>
        <a href="{{ root_path }}logout/">{% trans 'Log out' %}</a>
    </li>
{% endblock %}


{% block title %}{% trans 'Password change' %}{% endblock %}
{% block content-class %}content-grid{% endblock %}

{% block content %}
{% spaceless %}
{# TODO: French translations alre all mixed up with change "MY" password form ... #}
{#<h1>{% trans 'Password change' %}</h1>#}
<form action="{{ form_url }}" method="post" selected="true" class="panel"  id="{{ opts.module_name }}_form">{% csrf_token %}{% block form_top %}{% endblock %}
{% if is_popup %}<input type="hidden" name="_popup" value="1" />{% endif %}
    <h1>{% trans "Change password: " %} {{ original }}</h1>
    
    <div class="ui-bar ui-bar-e">
    	{% blocktrans with original.username as username %}Enter a new password for the user <strong>{{ username }}</strong>.{% endblocktrans %}
        {% if form.errors %}
   		 <p class="errornote">{% blocktrans count form.errors.items|length as counter %}Please correct the error below.{% plural %}Please correct the errors below.{% endblocktrans %} </p>{% endif %}
    </div>
    
    <div class="ui-body ui-body-c">
        <div data-role="fieldcontain">
            <label for="id_new_password1" class="required">{% trans "New password:" %}</label>
            {% if form.password1.errors %}{{ form.password1.errors }}{% endif %}
            {{ form.password1 }}
        </div>
        <div data-role="fieldcontain">
            <label for="id_new_password2" class="required">{% trans "Confirm password:" %}</label>
            {% if form.password2.errors %}{{ form.password2.errors }}{% endif %}
            {{ form.password2 }}
        </div>
        <div data-role="fieldcontain">
        	<p class="help">{% trans "Enter the same password as above, for verification." %}
            <input type="hidden" name="this_is_the_password_form" value="1" />
            <input type="hidden" name="post_data" value="{{ post_data }}" />
       </div>
    </div>
    
</form>
{% endspaceless %}
{% endblock %}

{% block page.footer %}
<div for="footer_id" data-role="footer" class="ui-bar" data-position="fixed" data-backbtn="false">
	<a id="save-object" data-theme="b" data-iconpos="left" data-icon="check" onclick="document.forms[0].submit();">{% trans 'Change my password' %}</a>
	<a id="clear-object" data-theme="b" data-iconpos="left" data-icon="delete" onclick="document.forms[0].reset();" class="ui-btn-delete">{% trans "Clear" %}</a>
	
	<script>
    $(function(){
		$('#save-object').bind('click', function(){
            $('form:first').submit()
            return false
        })
	})
	</script>
</div>
{% endblock %}
